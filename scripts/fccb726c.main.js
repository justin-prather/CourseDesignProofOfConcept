function tick(a){update&&(update=!1,updateList(),stage.update(a))}var update=!1,canvas,stage,scale,railLength,template,activeRail=null,rails=[],dblClick=!1,mode=0;$(function(){template=Handlebars.compile($("#rails-template").html()),$("#submit").click(setRingParams),$("#measure").click(event,measure),canvas=document.getElementById("demoCanvas"),canvas.addEventListener("mousewheel",MouseWheelHandler,!1),setRingParams(),stage=new createjs.Stage(canvas),createjs.Touch.enable(stage),stage.addEventListener("stagemousedown",function(a){dblClick?(rails.push(newRail("Purple","red",a.stageX,a.stageY)),update=!0):(dblClick=!0,setTimeout(function(){dblClick=!1},200),0==mode&&(null!=activeRail&&(activeRail.children[0].visible=!1),activeRail=null,update=!0))}),$("#rails").on("click",".delete",function(){var a=event.target,b=$(a).parent().attr("id");stage.removeChild(rails[b]),rails.splice(b,1),update=!0}),stage.update(),createjs.Ticker.addEventListener("tick",tick)});var setRingParams=function(){var a=Number($("#widthInput").val()),b=Number($("#heightInput").val());if(b>a){var c=a;a=b,b=c,$("#widthInput").val(a),$("#heightInput").val(b)}railLength=$("#railLength").val();var d=b/a,e=$(".container").width();canvas.width=e,scale=e/a,canvas.height=e*d,activeRail=null;for(var f=rails.length,g=[],h=0;f>h;h++)g.push(newRail("Purple","red",rails[h].x,rails[h].y,rails[h].rotation,!1)),stage.removeChild(rails[h]);rails=g,update=!0},newRail=function(a,b,c,d,e,f){e="undefined"!=typeof e?e:0,f="undefined"!=typeof f?f:!0;var g=new createjs.Shape,h=new createjs.Shape,i=new createjs.Container;return i.mouseChildren=!1,g.graphics.beginFill(a).drawRect(0,0,railLength*scale,1.5*scale),h.graphics.beginRadialGradientFill([b,"rgba(255, 255, 255, 0)"],[.9,.1],0,0,0,0,0,railLength*scale*1.2).drawCircle(0,0,railLength*scale/2),h.alpha=.9,g.regX=railLength*scale/2,g.regY=scale,i.x=c,i.y=d,i.addChild(h),i.addChild(g),i.rotation=e,i.on("mousedown",function(a){this.offset={x:this.x-a.stageX,y:this.y-a.stageY}}),i.on("click",function(a){if(0==mode)activeRail=this,this.children[0].visible=!0,update=!0;else if(1==mode)if(null==activeRail||void 0==activeRail)activeRail=this,this.children[0].visible=!0,update=!0;else{var b=activeRail.x,c=activeRail.y,d=this.x,e=this.y,f=Math.abs(hypoteneus(d-b,e-c));$("#measurment").text(parseFloat(f/scale).toFixed(2)+" Feet"),measure()}}),i.on("pressmove",function(a){this.x=a.stageX+this.offset.x,this.y=a.stageY+this.offset.y,update=!0}),stage.addChild(i),h.visible=!1,f&&(activeRail=i,h.visible=!0),i},hypoteneus=function(a,b){return Math.sqrt(a*a+b*b)},updateList=function(){var a={};$("#rails").empty();for(var b=0;b<rails.length;b++)a.index=b,a.x=parseFloat(rails[b].x/scale).toFixed(2),a.y=parseFloat(rails[b].y/scale).toFixed(2),a.angle=rails[b].rotation,$("#rails").append(template(a))},MouseWheelHandler=function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));if(null!=activeRail&&void 0!=activeRail){var c=activeRail.rotation;c+=5*b,c>360?activeRail.rotation=c-360:0>c?activeRail.rotation=c+360:activeRail.rotation=c,update=!0}return a.preventDefault(),!1},measure=function(){1!=mode?(mode=1,$("#measure").addClass("btn-success"),$("#measure").removeClass("btn-default")):(mode=0,$("#measure").removeClass("btn-success"),$("#measure").addClass("btn-default"))};