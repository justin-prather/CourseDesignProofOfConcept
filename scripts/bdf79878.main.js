function tick(a){update&&(update=!1,updateList(),stage.update(a))}var update=!1,canvas,stage,scale,railLength,template,activeRail,rails=[],dblClick=!1,setRingParams=function(){var a=$("#widthInput").val(),b=$("#heightInput").val();railLength=$("#railLength").val();var c=b/a,d=$(".container").width();canvas.width=d,scale=d/a,console.log(railLength*scale),canvas.height=d*c;for(var e=rails.length,f=0;e>f;f++)rails.push(newRail("Purple","red",rails[f].x,rails[f].y)),stage.removeChild(rails[f]),rails.splice(f,1);update=!0};$(function(){template=Handlebars.compile($("#rails-template").html()),$("#submit").click(setRingParams),canvas=document.getElementById("demoCanvas"),canvas.addEventListener("mousewheel",MouseWheelHandler,!1),setRingParams(),stage=new createjs.Stage(canvas),stage.addEventListener("stagemousedown",function(a){dblClick?(rails.push(newRail("Purple","red",a.stageX,a.stageY)),update=!0):(dblClick=!0,setTimeout(function(){dblClick=!1},200),activeRail=null)}),$("#rails").on("click",".delete",function(){var a=event.target,b=$(a).parent().attr("id");stage.removeChild(rails[b]),rails.splice(b,1),update=!0}),stage.update(),createjs.Ticker.addEventListener("tick",tick)});var newRail=function(a,b,c,d){var e=new createjs.Shape,f=new createjs.Shape;return e.graphics.beginFill(a).drawRect(0,0,railLength*scale,1.5*scale),f.graphics.beginFill(b).drawCircle(0,0,railLength*scale/2),f.alpha=.3,f.visible=!1,e.regX=railLength*scale/2,e.regY=scale,e.x=f.x=c,e.y=f.y=d,e.rotation=90,e.on("mousedown",function(a){this.offset={x:this.x-a.stageX,y:this.y-a.stageY}}),e.on("click",function(a){console.log("hello"),activeRail=this}),e.on("pressmove",function(a){this.x=a.stageX+this.offset.x,this.y=a.stageY+this.offset.y,update=!0}),stage.addChild(f),stage.addChild(e),e},updateList=function(){var a={};$("#rails").empty();for(var b=0;b<rails.length;b++)a.index=b,a.x=parseFloat(rails[b].x/scale).toFixed(2),a.y=parseFloat(rails[b].y/scale).toFixed(2),a.angle=rails[b].rotation,$("#rails").append(template(a))},MouseWheelHandler=function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));if(null!=activeRail&&void 0!=activeRail){var c=activeRail.rotation;c+=5*b,c>360?activeRail.rotation=c-360:0>c?activeRail.rotation=c+360:activeRail.rotation=c,update=!0}return a.preventDefault(),!1};