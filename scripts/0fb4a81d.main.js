function tick(a){update&&(update=!1,updateList(),stage.update(a))}var update=!1,canvas,stage,scale,railLength,template,activeRail=null,rails=[],dblClick=!1,mode=0;$(function(){template=Handlebars.compile($("#rails-template").html()),$("#submit").click(setRingParams),$("#measure").click(event,measure),canvas=document.getElementById("demoCanvas"),canvas.addEventListener("mousewheel",MouseWheelHandler,!1),setRingParams(),stage=new createjs.Stage(canvas),stage.addEventListener("stagemousedown",function(a){dblClick?(rails.push(newRail("Purple","red",a.stageX,a.stageY)),update=!0):(dblClick=!0,setTimeout(function(){dblClick=!1},200),0==mode&&(null!=activeRail&&(activeRail.children[0].visible=!1),activeRail=null,update=!0))}),$("#rails").on("click",".delete",function(){var a=event.target,b=$(a).parent().attr("id");stage.removeChild(rails[b]),rails.splice(b,1),update=!0}),stage.update(),createjs.Ticker.addEventListener("tick",tick)});var setRingParams=function(){var a=Number($("#widthInput").val()),b=Number($("#heightInput").val());if(console.log(b+" "+a),console.log(b>a),b>a){var c=a;a=b,b=c,$("#widthInput").val(a),$("#heightInput").val(b)}railLength=$("#railLength").val();var d=b/a,e=$(".container").width();canvas.width=e,scale=e/a,console.log(railLength*scale),canvas.height=e*d;for(var f=rails.length,g=0;f>g;g++)rails.push(newRail("Purple","red",rails[g].x,rails[g].y)),stage.removeChild(rails[g]),rails.splice(g,1);update=!0},newRail=function(a,b,c,d){var e=new createjs.Shape,f=new createjs.Shape,g=new createjs.Container;return g.mouseChildren=!1,e.graphics.beginFill(a).drawRect(0,0,railLength*scale,1.5*scale),f.graphics.beginRadialGradientFill([b,"rgba(255, 255, 255, 0)"],[.9,.1],0,0,0,0,0,railLength*scale*1.2).drawCircle(0,0,railLength*scale/2),f.alpha=.9,e.regX=railLength*scale/2,e.regY=scale,g.x=c,g.y=d,e.rotation=90,g.addChild(f),g.addChild(e),g.on("mousedown",function(a){this.offset={x:this.x-a.stageX,y:this.y-a.stageY}}),g.on("click",function(a){if(0==mode)activeRail=this,this.children[0].visible=!0,update=!0;else if(1==mode)if(null==activeRail||void 0==activeRail)activeRail=this,this.children[0].visible=!0,update=!0;else{var b=activeRail.x,c=activeRail.y,d=this.x,e=this.y,f=Math.abs(hypoteneus(d-b,e-c));$("#measurment").toggleClass("hidden").text(parseFloat(f/scale).toFixed(2)+" Feet"),measure()}}),g.on("pressmove",function(a){this.x=a.stageX+this.offset.x,this.y=a.stageY+this.offset.y,update=!0}),stage.addChild(g),activeRail=g,g},hypoteneus=function(a,b){return Math.sqrt(a*a+b*b)},updateList=function(){var a={};$("#rails").empty();for(var b=0;b<rails.length;b++)a.index=b,a.x=parseFloat(rails[b].x/scale).toFixed(2),a.y=parseFloat(rails[b].y/scale).toFixed(2),a.angle=rails[b].rotation,$("#rails").append(template(a))},MouseWheelHandler=function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));if(null!=activeRail&&void 0!=activeRail){var c=activeRail.rotation;c+=5*b,c>360?activeRail.rotation=c-360:0>c?activeRail.rotation=c+360:activeRail.rotation=c,update=!0}return a.preventDefault(),!1},measure=function(){1!=mode?(mode=1,$("#measure").addClass("btn-success"),$("#measure").removeClass("btn-default")):(mode=0,$("#measure").removeClass("btn-success"),$("#measure").addClass("btn-default"))};