"use strict";function tick(a){update&&(update=!1,updateList(),stage.update(a))}var update=!1,canvas,stage,scale,railLength,spread,template,activeRail=-1,rails=[],dblClick=!1,mode=0;$(function(){template=Handlebars.compile($("#rails-template").html()),$("#submit").click(setRingParams),$("#measure").click(event,measureClick),canvas=document.getElementById("demoCanvas"),canvas.addEventListener("mousewheel",MouseWheelHandler,!1),setRingParams(),stage=new createjs.Stage(canvas),createjs.Touch.enable(stage),stage.on("stagemousedown",function(a){if(dblClick){var b=oxer(rails.length,"Purple","red",a.stageX,a.stageY,spread);rails.push(b),update=!0}else dblClick=!0,setTimeout(function(){dblClick=!1},200),0==mode&&(-1!=activeRail&&(rails[activeRail].children[0].visible=!1),activeRail=-1,update=!0)}),$("#rails").on("click",".delete",function(){var a=event.target,b=$(a).parent().parent().attr("id");stage.removeChild(rails[b]),rails.splice(b,1),activeRail=-1,update=!0}),$("#rails").on("click",".update",function(){var a=event.target,b=$(a).parent().parent().attr("id"),c=rails[b];c.x=Number($("#xCoordinate"+b).val())*scale,c.y=Number($("#yCoordinate"+b).val())*scale,c.spread=Number($("#spread"+b).val()),c.rotation=Number($("#angle"+b).val()),update=!0}),stage.update(),createjs.Ticker.addEventListener("tick",tick)});var setRingParams=function(){var a=Number($("#widthInput").val()),b=Number($("#heightInput").val());if(b>a){var c=a;a=b,b=c,$("#widthInput").val(a),$("#heightInput").val(b)}railLength=$("#railLength").val(),spread=$("#spread").val();var d=b/a,e=$(".container").width();canvas.width=e,scale=e/a,canvas.height=e*d,activeRail=-1;for(var f=rails.length,g=[],h=0;f>h;h++)g.push(rails[h].type(h,"Purple","red",rails[h].x,rails[h].y,spread,rails[h].rotation,!1)),stage.removeChild(rails[h]);rails=g,update=!0},updateList=function(){var a={};$("#rails").empty();for(var b=0;b<rails.length;b++)a.index=b,a.x=parseFloat(rails[b].x/scale).toFixed(2),a.y=parseFloat(rails[b].y/scale).toFixed(2),a.angle=rails[b].rotation,a["class"]=activeRail==b?"selected":"",a.spread=rails[b].spread,$("#rails").append(template(a))},MouseWheelHandler=function(a){var b=Math.max(-1,Math.min(1,a.wheelDelta||-a.detail));if(-1!=activeRail){var c=rails[activeRail].rotation;c+=b,c>180?rails[activeRail].rotation=c-180:0>c?rails[activeRail].rotation=c+180:rails[activeRail].rotation=c,update=!0}return a.preventDefault(),!1},measureClick=function(){1!=mode?(mode=1,$("#measure").addClass("btn-success"),$("#measure").removeClass("btn-default")):(mode=0,$("#measure").removeClass("btn-success"),$("#measure").addClass("btn-default"))},hypoteneus=function(a,b){return Math.sqrt(a*a+b*b)},vertical=function(a,b,c,d,e,f,g,h){g="undefined"!=typeof g?g:0,h="undefined"!=typeof h?h:!0,f="undefined"!=typeof f?f:0;var i=new createjs.Shape,j=new createjs.Shape,k=new createjs.Container;return k.mouseChildren=!1,i.graphics.beginFill(b).drawRect(0,0,railLength*scale,1.5*scale),j.graphics.beginRadialGradientFill([c,"rgba(255, 255, 255, 0)"],[.9,.1],0,0,0,0,0,railLength*scale*1.2).drawCircle(0,0,railLength*scale/2),j.alpha=.9,i.regX=railLength*scale/2,i.regY=1.5*scale/2,k.x=d,k.y=e,k.addChild(j),k.addChild(i),k.rotation=g,k.on("mousedown",function(a){onContainerMouseDown(a)}),k.on("click",function(a){onContainerClick(a)}),k.on("pressmove",function(a){onContainerPressMove(a)}),stage.addChild(k),j.visible=!1,h&&(activeRail=rails.length,j.visible=!0),k.index=a,k.type=vertical,k.spread=f,k},oxer=function(a,b,c,d,e,f,g,h){g="undefined"!=typeof g?g:0,h="undefined"!=typeof h?h:!0;var i=new createjs.Shape,j=new createjs.Shape,k=new createjs.Shape,l=new createjs.Shape,m=new createjs.Container;return m.mouseChildren=!1,i.graphics.beginFill(b).drawRect(0,0,railLength*scale,1.5*scale),j.graphics.beginFill(b).drawRect(0,0,railLength*scale,1.5*scale),k.graphics.beginFill("White").drawRect(0,0,railLength*scale,f*scale),l.graphics.beginRadialGradientFill([c,"rgba(255, 255, 255, 0)"],[.9,.1],0,0,0,0,0,railLength*scale*1.2).drawCircle(0,0,railLength*scale/2*(1+.5*f/railLength)),l.alpha=.9,i.regX=railLength*scale/2,i.regY=1.5*scale/2+f*scale/2,j.regX=railLength*scale/2,j.regY=1.5*scale/2-f*scale/2,k.regX=railLength*scale/2,k.regY=f*scale/2,m.x=d,m.y=e,m.addChild(l),m.addChild(k),m.addChild(i),m.addChild(j),m.rotation=g,m.on("mousedown",function(a){onContainerMouseDown(a)}),m.on("click",function(a){onContainerClick(a)}),m.on("pressmove",function(a){onContainerPressMove(a)}),stage.addChild(m),l.visible=!1,h&&(activeRail=rails.length,l.visible=!0),m.index=a,m.type=oxer,m.spread=f,m},onContainerMouseDown=function(a){console.log("Jump Clicked"),a.target.offset={x:a.target.x-a.stageX,y:a.target.y-a.stageY},0==mode&&(activeRail=a.target.index,a.target.children[0].visible=!0,update=!0)},onContainerClick=function(a){if(1==mode)if(-1==activeRail)activeRail=a.target.index,a.target.children[0].visible=!0,update=!0;else{var b=rails[activeRail].x,c=rails[activeRail].y,d=a.target.x,e=a.target.y,f=Math.abs(hypoteneus(d-b,e-c));$("#measurment").text(parseFloat(f/scale).toFixed(2)+" Feet"),measureClick()}},onContainerPressMove=function(a){a.target.x=a.stageX+a.target.offset.x,a.target.y=a.stageY+a.target.offset.y,update=!0};